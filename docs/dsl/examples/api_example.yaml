# Example: Fraud Detection API Configuration
# This is a reference example showing all supported features

name: fraud_detector
base_url: "https://api.frauddetector.example.com"

# Authentication using header
auth:
  type: header
  name: "X-API-Key"
  value: "${env.fraud_detector.api_key}"  # Read from environment variable (config/server.yaml)

# Default timeout for all endpoints (optional)
timeout_ms: 5000

endpoints:
  # GET endpoint: Check IP reputation (quick lookup)
  check_ip:
    method: GET
    path: "/v1/ip/{ip_address}"
    timeout_ms: 3000  # Quick lookup - 3 seconds
    params:
      ip_address: event.ip_address               # Read IP from event
      include_history: "true"                     # Literal value
      format: "json"                              # Literal value
    query_params:
      - include_history
      - format
    response:
      mapping:
        risk_score: riskScore
        is_vpn: vpn
        is_proxy: proxy
      fallback:
        risk_score: 50
        is_vpn: false
        is_proxy: false
        error: true

  # POST endpoint: Analyze transaction (complex analysis)
  analyze_transaction:
    method: POST
    path: "/v1/transactions/analyze"
    timeout_ms: 10000  # Complex analysis - 10 seconds
    params:
      transaction_id: event.transaction_id       # Read from event
      amount: event.amount                       # Read from event
      currency: event.currency                   # Read from event
      user_id: event.user.id                     # Nested field from event
      user_email: event.user.email               # Nested field from event
      ip_address: event.ip_address               # Read from event
      device_id: event.device_id                 # Read from event
    request_body: |
      {
        "transaction_id": "${transaction_id}",
        "amount": ${amount},
        "currency": "${currency}",
        "user": {
          "id": "${user_id}",
          "email": "${user_email}"
        },
        "metadata": {
          "ip_address": "${ip_address}",
          "device_id": "${device_id}"
        }
      }
    response:
      mapping:
        risk_score: analysis.riskScore
        recommendation: analysis.recommendation
        confidence: analysis.confidence
        reason_codes: analysis.reasonCodes
      fallback:
        risk_score: 60
        recommendation: "REVIEW"
        confidence: 0.5
        error: true

  # PUT endpoint: Update risk score
  update_risk:
    method: PUT
    path: "/v1/transactions/{transaction_id}/risk"
    params:
      transaction_id: event.transaction_id       # Read from event
      risk_score: vars.computed_risk             # Read from vars
      reason: "Manual review override"           # Literal value
    request_body: |
      {
        "risk_score": ${risk_score},
        "reason": "${reason}"
      }
    response:
      mapping:
        updated: success
        updated_at: timestamp
      fallback:
        updated: false
        error: true

  # PATCH endpoint: Partial update
  update_status:
    method: PATCH
    path: "/v1/transactions/{transaction_id}"
    params:
      transaction_id: event.transaction_id       # Read from event
      status: vars.decision_status               # Read from vars
    request_body: |
      {
        "status": "${status}"
      }
    response:
      mapping:
        status: status
        updated_at: updatedAt
      fallback:
        status: "UNKNOWN"
        error: true

  # DELETE endpoint: Remove transaction
  delete_transaction:
    method: DELETE
    path: "/v1/transactions/{transaction_id}"
    params:
      transaction_id: event.transaction_id   # Read from event
