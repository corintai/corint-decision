# PostgreSQL ç¤ºä¾‹æ•°æ® Feature è®¡ç®—è¦†ç›–åˆ†æ

## âœ… Feature è®¡ç®—ç±»å‹è¦†ç›–æƒ…å†µ

### 1. Count Features (è®¡æ•°ç‰¹å¾) âœ…

| Feature | æµ‹è¯•æ•°æ® | çŠ¶æ€ |
|---------|---------|------|
| `login_count_24h` | 4 ä¸ª login äº‹ä»¶ï¼ˆåˆ†å¸ƒåœ¨ 20h å‰åˆ°å½“å‰ï¼‰ | âœ… |
| `login_count_1h` | 2 ä¸ª login äº‹ä»¶ï¼ˆ15 åˆ†é’Ÿå‰å’Œå½“å‰ï¼‰ | âœ… |
| `failed_login_count_1h` | 1 ä¸ª failed loginï¼ˆ15 åˆ†é’Ÿå‰ï¼‰ | âœ… |
| `transaction_count_24h` | å¤šä¸ª transaction äº‹ä»¶ | âœ… |

**æ•°æ®è¦†ç›–**ï¼š
- user_001: 4 ä¸ª loginï¼ˆåŒ…å« 1 ä¸ª failedï¼‰
- user_001: 5 ä¸ª transactionï¼ˆåˆ†å¸ƒåœ¨ 15 å¤©å‰åˆ°å½“å‰ï¼‰
- user_003: 3 ä¸ª transactionï¼ˆé«˜é¢‘ç‡ï¼Œç”¨äº velocity æµ‹è¯•ï¼‰

### 2. Aggregation Features (èšåˆç‰¹å¾) âœ…

| Feature | æµ‹è¯•æ•°æ® | çŠ¶æ€ |
|---------|---------|------|
| `transaction_sum_24h` | 5 ä¸ªäº¤æ˜“ï¼Œé‡‘é¢ï¼š299.99, 150.50, 450.00, 200.00, 100.00 | âœ… |
| `transaction_sum_7d` | 4 ä¸ªäº¤æ˜“ï¼ˆ5 å¤©å‰åˆ°å½“å‰ï¼‰ | âœ… |
| `avg_transaction_30d` | 5 ä¸ªäº¤æ˜“ï¼Œå¹³å‡å€¼ = (299.99+150.50+450.00+200.00+100.00)/5 = 240.10 | âœ… |
| `max_transaction_7d` | æœ€å¤§é‡‘é¢ï¼š450.00 | âœ… |
| `min_transaction_7d` | æœ€å°é‡‘é¢ï¼š100.00 | âœ… |

**é‡‘é¢åˆ†å¸ƒ**ï¼š
- 100.00 (15 å¤©å‰)
- 150.50 (2 å°æ—¶å‰)
- 200.00 (5 å¤©å‰)
- 299.99 (å½“å‰)
- 450.00 (1 å¤©å‰)
- 1000.00, 2000.00, 5000.00 (user_003 é«˜é‡‘é¢)

### 3. Count Distinct Features (å»é‡è®¡æ•°ç‰¹å¾) âœ…

| Feature | æµ‹è¯•æ•°æ® | çŠ¶æ€ |
|---------|---------|------|
| `unique_devices_7d` | user_001 ä½¿ç”¨ 2 ä¸ªè®¾å¤‡ï¼ˆdevice_001, device_002ï¼‰ | âœ… |
| `unique_devices_30d` | user_001 ä½¿ç”¨ 2 ä¸ªè®¾å¤‡ | âœ… |
| `unique_ips_24h` | user_001 ä½¿ç”¨ 2 ä¸ª IPï¼ˆ203.0.113.1, 203.0.113.2ï¼‰ | âœ… |
| `unique_cities_30d` | user_001 è®¿é—® 3 ä¸ªåŸå¸‚ï¼ˆNew York, Boston, Los Angelesï¼‰ | âœ… |

**æ•°æ®è¦†ç›–**ï¼š
- user_001: 2 ä¸ªè®¾å¤‡ï¼ˆdevice_001, device_002ï¼‰
- user_001: 2 ä¸ª IPï¼ˆ203.0.113.1, 203.0.113.2ï¼‰
- user_001: 3 ä¸ªåŸå¸‚ï¼ˆNew York, Boston, Los Angelesï¼‰

### 4. Cross-Dimension Count Features (è·¨ç»´åº¦è®¡æ•°ç‰¹å¾) âœ…

| Feature | æµ‹è¯•æ•°æ® | çŠ¶æ€ |
|---------|---------|------|
| `devices_per_ip_24h` | IP 203.0.113.1 å…³è” 1 ä¸ªè®¾å¤‡ï¼Œ203.0.113.2 å…³è” 1 ä¸ªè®¾å¤‡ | âœ… |
| `users_per_ip_24h` | IP 203.0.113.1 å…³è” user_001 | âœ… |
| `users_per_device_30d` | device_001 å…³è” user_001 | âœ… |

### 5. Temporal Features (æ—¶é—´ç‰¹å¾) âœ…

| Feature | æµ‹è¯•æ•°æ® | çŠ¶æ€ |
|---------|---------|------|
| `account_first_seen` | user_001: 2024-11-01 (35 å¤©å‰) | âœ… |
| `last_login_at` | user_001: 2024-12-05 10:00:00 (å½“å‰) | âœ… |
| `account_age_days` | user_001: 35 å¤©ï¼Œuser_003: 7 å¤© | âœ… |
| `device_first_seen` | device_001: 2024-11-01 | âœ… |
| `device_age_days` | device_001: 35 å¤© | âœ… |
| `ip_first_seen` | 203.0.113.1: 2024-11-01 | âœ… |

**æ—¶é—´åˆ†å¸ƒ**ï¼š
- 35 å¤©å‰ï¼šregister (user_001)
- 15 å¤©å‰ï¼štransaction (user_001)
- 7 å¤©å‰ï¼šregister (user_003), login (user_001)
- 5 å¤©å‰ï¼štransaction (user_001)
- 1 å¤©å‰ï¼štransaction (user_001)
- 20 å°æ—¶å‰ï¼šlogin (user_001)
- 2 å°æ—¶å‰ï¼štransaction (user_001)
- 20 åˆ†é’Ÿå‰ï¼štransaction (user_003)
- 15 åˆ†é’Ÿå‰ï¼šfailed login (user_001)
- 10 åˆ†é’Ÿå‰ï¼štransaction (user_003)
- å½“å‰ï¼šlogin, transaction

### 6. Velocity Features (é€Ÿåº¦ç‰¹å¾) âœ…

| Feature | æµ‹è¯•æ•°æ® | çŠ¶æ€ |
|---------|---------|------|
| `exceeds_login_velocity` | user_001: 2 æ¬¡ login/1hï¼ˆæœªè¶…è¿‡é˜ˆå€¼ 10ï¼‰ | âœ… |
| `exceeds_transaction_velocity` | user_003: 3 æ¬¡ transaction/1hï¼ˆè¶…è¿‡é˜ˆå€¼ 5ï¼‰ | âœ… |
| `exceeds_ip_velocity` | IP 203.0.113.3: 3 æ¬¡äº‹ä»¶/1h | âœ… |

**Velocity æµ‹è¯•åœºæ™¯**ï¼š
- æ­£å¸¸é€Ÿåº¦ï¼šuser_001 (2 login/1h)
- é«˜é€Ÿåº¦ï¼šuser_003 (3 transaction/1hï¼Œè¶…è¿‡é˜ˆå€¼ 5)

### 7. Time Window Coverage (æ—¶é—´çª—å£è¦†ç›–) âœ…

| Window | æ•°æ®ç‚¹æ•°é‡ | çŠ¶æ€ |
|--------|-----------|------|
| 1 hour | 5 ä¸ªäº‹ä»¶ï¼ˆ15 åˆ†é’Ÿå‰åˆ°å½“å‰ï¼‰ | âœ… |
| 24 hours | 8+ ä¸ªäº‹ä»¶ï¼ˆ20 å°æ—¶å‰åˆ°å½“å‰ï¼‰ | âœ… |
| 7 days | 10+ ä¸ªäº‹ä»¶ï¼ˆ7 å¤©å‰åˆ°å½“å‰ï¼‰ | âœ… |
| 30 days | 12+ ä¸ªäº‹ä»¶ï¼ˆ30 å¤©å‰åˆ°å½“å‰ï¼‰ | âœ… |

## ğŸ“Š æ•°æ®ç»Ÿè®¡

### äº‹ä»¶ç±»å‹åˆ†å¸ƒ
- **Register**: 2 ä¸ªï¼ˆuser_001, user_003ï¼‰
- **Login**: 4 ä¸ªï¼ˆuser_001: 3 success + 1 failedï¼‰
- **Transaction**: 8 ä¸ªï¼ˆuser_001: 5, user_003: 3ï¼‰

### ç”¨æˆ·åˆ†å¸ƒ
- **user_001**: 11 ä¸ªäº‹ä»¶ï¼ˆ1 register + 4 login + 5 transaction + 1 failed loginï¼‰
- **user_003**: 5 ä¸ªäº‹ä»¶ï¼ˆ1 register + 3 transaction + 1 high-risk transactionï¼‰

### è®¾å¤‡åˆ†å¸ƒ
- **device_001**: ä¸»è¦è®¾å¤‡ï¼ˆuser_001ï¼‰
- **device_002**: æ¬¡è¦è®¾å¤‡ï¼ˆuser_001ï¼‰
- **device_003**: æ–°è®¾å¤‡ï¼ˆuser_003ï¼‰

### IP åˆ†å¸ƒ
- **203.0.113.1**: user_001 ä¸»è¦ IP
- **203.0.113.2**: user_001 æ¬¡è¦ IP
- **203.0.113.3**: user_003 IPï¼ˆé«˜é£é™©ï¼‰

### åŸå¸‚åˆ†å¸ƒ
- **New York**: ä¸»è¦åŸå¸‚ï¼ˆuser_001ï¼‰
- **Boston**: æ¬¡è¦åŸå¸‚ï¼ˆuser_001ï¼‰
- **Los Angeles**: å†å²åŸå¸‚ï¼ˆuser_001ï¼‰
- **Shanghai**: é«˜é£é™©åŸå¸‚ï¼ˆuser_003ï¼‰

## âœ… è¦†ç›–å®Œæ•´æ€§æ£€æŸ¥

### å·²è¦†ç›–çš„ Feature Operators
- âœ… Count
- âœ… Sum
- âœ… Avg
- âœ… Max
- âœ… Min
- âœ… CountDistinct
- âœ… CrossDimensionCount
- âœ… FirstSeen
- âœ… LastSeen
- âœ… TimeSince
- âœ… Velocity

### æœªè¦†ç›–çš„ Feature Operatorsï¼ˆéœ€è¦å¤–éƒ¨æ•°æ®æºï¼‰
- âš ï¸ ProfileLookupï¼ˆéœ€è¦ user_profiles è¡¨ï¼‰
- âš ï¸ FeatureStoreLookupï¼ˆéœ€è¦ Redisï¼‰

## ğŸ¯ æµ‹è¯•å»ºè®®

1. **åŸºæœ¬åŠŸèƒ½æµ‹è¯•**ï¼šä½¿ç”¨ user_001 çš„æ•°æ®æµ‹è¯•æ‰€æœ‰åŸºæœ¬ feature
2. **Velocity æµ‹è¯•**ï¼šä½¿ç”¨ user_003 çš„æ•°æ®æµ‹è¯•é«˜é¢‘ç‡åœºæ™¯
3. **æ—¶é—´çª—å£æµ‹è¯•**ï¼šéªŒè¯ä¸åŒæ—¶é—´çª—å£ï¼ˆ1h, 24h, 7d, 30dï¼‰çš„è®¡ç®—
4. **è¾¹ç•Œæƒ…å†µæµ‹è¯•**ï¼šæµ‹è¯•ç©ºç»“æœã€å•æ¡è®°å½•ã€å¤šæ¡è®°å½•çš„åœºæ™¯

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ—¶é—´æˆ³**ï¼šæ‰€æœ‰æ—¶é—´æˆ³ä½¿ç”¨ UTCï¼ˆ+00ï¼‰ï¼Œç¡®ä¿æ—¶åŒºä¸€è‡´æ€§
2. **JSONB å­—æ®µ**ï¼šattributes å­—æ®µåŒ…å«æ‰€æœ‰ä¸šåŠ¡å’ŒæŠ€æœ¯ç»´åº¦
3. **æ•°æ®å®Œæ•´æ€§**ï¼šæ¯ä¸ªäº‹ä»¶éƒ½æœ‰å¯¹åº”çš„ request_idï¼Œå¯ä»¥å…³è”åˆ° risk_decisions
4. **æµ‹è¯•æ•°æ®é‡**ï¼šå½“å‰æ•°æ®é‡é€‚åˆåŠŸèƒ½æµ‹è¯•ï¼Œæ€§èƒ½æµ‹è¯•éœ€è¦æ›´å¤šæ•°æ®

